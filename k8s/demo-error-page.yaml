apiVersion: v1
kind: ConfigMap
metadata:
  name: demo-error-page
  namespace: print-serv
data:
  index.html: |
    <!DOCTYPE html>
    <html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PDF Service - Error Analysis System Demo</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    </head>
    <body>
        <div class="container mt-4">
            <div class="row">
                <div class="col-12">
                    <h1 class="text-center mb-4">
                        <i class="bi bi-check-circle-fill text-success"></i>
                        –°–∏—Å—Ç–µ–º–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
                    </h1>
                    
                    <div class="alert alert-success" role="alert">
                        <h4 class="alert-heading">‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞!</h4>
                        <p>–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –æ—à–∏–±–æ–∫ —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞. –û–∂–∏–¥–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –∑–µ—Ä–∫–∞–ª–∞ Docker Hub.</p>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5><i class="bi bi-database"></i> –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li>‚úÖ –¢–∞–±–ª–∏—Ü–∞ `error_logs` —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π</li>
                                        <li>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º</li>
                                        <li>‚úÖ –£—Ä–æ–≤–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ (critical, high, medium, low)</li>
                                        <li>‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenTelemetry —Ç—Ä–µ–π—Å–∏–Ω–≥–æ–º</li>
                                        <li>‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Å—Ç–µ–∫-—Ç—Ä–µ–π—Å—ã</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-info text-white">
                                    <h5><i class="bi bi-api"></i> API Endpoints</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li>‚úÖ <code>GET /api/v1/errors</code> - –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π</li>
                                        <li>‚úÖ <code>GET /api/v1/errors/stats</code> - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∑–¥–æ—Ä–æ–≤—å–µ</li>
                                        <li>‚úÖ <code>GET /api/v1/errors/:id</code> - –î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—à–∏–±–∫–∏</li>
                                        <li>‚úÖ <code>GET /test-error</code> - –¢–µ—Å—Ç–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—à–∏–±–æ–∫</li>
                                        <li>‚úÖ <code>GET /test-timeout</code> - –¢–µ—Å—Ç timeout –æ—à–∏–±–æ–∫</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h5><i class="bi bi-display"></i> –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li>‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Bootstrap –¥–∏–∑–∞–π–Ω</li>
                                        <li>‚úÖ –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (30s)</li>
                                        <li>‚úÖ –§–∏–ª—å—Ç—Ä—ã: –ø–µ—Ä–∏–æ–¥, —Ç–∏–ø, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å</li>
                                        <li>‚úÖ –°—Ç–µ–∫-—Ç—Ä–µ–π—Å—ã —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞</li>
                                        <li>‚úÖ –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –≤ Jaeger —Ç—Ä–µ–π—Å–∏–Ω–≥</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-warning text-white">
                                    <h5><i class="bi bi-lightbulb"></i> –£–º–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫</li>
                                        <li>‚úÖ –†–µ—à–µ–Ω–∏—è –¥–ª—è timeout: "–£–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–æ 90s"</li>
                                        <li>‚úÖ –†–µ—à–µ–Ω–∏—è –¥–ª—è validation: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å JSON —Å—Ö–µ–º—É"</li>
                                        <li>‚úÖ –†–µ—à–µ–Ω–∏—è –¥–ª—è connection: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS"</li>
                                        <li>‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header bg-dark text-white">
                            <h5><i class="bi bi-info-circle"></i> –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <h6>–°—Ö–µ–º–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:</h6>
                                    <ol>
                                        <li>‚úÖ <strong>Push –≤ Docker Hub:</strong> gimmyhat/pdf-service-go:latest</li>
                                        <li>‚è≥ <strong>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–µ—Ä–∫–∞–ª–∞:</strong> dh-mirror.gitverse.ru (15-30 –º–∏–Ω)</li>
                                        <li>‚è≥ <strong>Pull –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ:</strong> imagePullPolicy: Always</li>
                                        <li>‚è≥ <strong>–ê–∫—Ç–∏–≤–∞—Ü–∏—è:</strong> /errors, /api/v1/errors</li>
                                    </ol>
                                    
                                    <h6>–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–≥–∏:</h6>
                                    <ul>
                                        <li><code>errors-v2025080602</code> - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–µ–≥ –¥–ª—è —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</li>
                                        <li><code>hotfix-env</code> - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è</li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h4><span class="badge bg-info">–û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</span></h4>
                                        <p class="mt-3">–û–±—Ä–∞–∑: <br><code>dh-mirror.gitverse.ru/gimmyhat/pdf-service-go:errors-v2025080602</code></p>
                                        
                                        <div class="mt-3">
                                            <h6>–¢–µ–∫—É—â–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ endpoints:</h6>
                                            <a href="http://172.27.239.30:31005/health" target="_blank" class="btn btn-sm btn-success">Health</a>
                                            <a href="http://172.27.239.30:31005/stats" target="_blank" class="btn btn-sm btn-primary">Stats</a>
                                            <a href="http://172.27.239.30:31005/metrics" target="_blank" class="btn btn-sm btn-secondary">Metrics</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info mt-4" role="alert">
                        <h6><i class="bi bi-clock"></i> –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å:</h6>
                        <p class="mb-2">1. <strong>–û–±—Ä–∞–∑ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω</strong> –≤ Docker Hub —Å –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫</p>
                        <p class="mb-2">2. <strong>–†–æ—Å—Å–∏–π—Å–∫–æ–µ –∑–µ—Ä–∫–∞–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è</strong> —Å Docker Hub (–æ–±—ã—á–Ω–æ 15-30 –º–∏–Ω—É—Ç)</p>
                        <p class="mb-2">3. <strong>–ö–ª–∞—Å—Ç–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∞–µ—Ç</strong> –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—Ä–∞–∑ –±–ª–∞–≥–æ–¥–∞—Ä—è imagePullPolicy: Always</p>
                        <p class="mb-0">4. <strong>Endpoints —Å—Ç–∞–Ω—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:</strong> /errors, /api/v1/errors, /test-error, /test-timeout</p>
                    </div>

                    <div class="text-center mt-4">
                        <button class="btn btn-primary btn-lg me-3" onclick="checkStatus()">
                            <i class="bi bi-arrow-clockwise"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                        </button>
                        <a href="http://172.27.239.30:31005/stats" class="btn btn-success btn-lg" target="_blank">
                            <i class="bi bi-graph-up"></i> –¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function checkStatus() {
                fetch('/errors')
                    .then(response => {
                        if (response.ok) {
                            alert('üéâ –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –∞–∫—Ç–∏–≤–Ω–∞! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é –Ω–∞ /errors');
                            window.location.href = '/errors';
                        } else {
                            alert('‚è≥ –°–∏—Å—Ç–µ–º–∞ –µ—â–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.');
                        }
                    })
                    .catch(() => {
                        alert('‚è≥ –°–∏—Å—Ç–µ–º–∞ –µ—â–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.');
                    });
            }

            // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(function() {
                fetch('/errors')
                    .then(response => {
                        if (response.ok) {
                            document.body.innerHTML = '<div class="container mt-5 text-center"><h1 class="text-success"><i class="bi bi-check-circle-fill"></i> –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞!</h1><p>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ /errors...</p></div>';
                            setTimeout(() => window.location.href = '/errors', 2000);
                        }
                    })
                    .catch(() => {});
            }, 30000);
        </script>
    </body>
    </html>
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: demo-error-page
  namespace: print-serv
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo-error-page
  template:
    metadata:
      labels:
        app: demo-error-page
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        ports:
        - containerPort: 80
        volumeMounts:
        - name: html-content
          mountPath: /usr/share/nginx/html
      volumes:
      - name: html-content
        configMap:
          name: demo-error-page
---
apiVersion: v1
kind: Service
metadata:
  name: demo-error-page
  namespace: print-serv
spec:
  selector:
    app: demo-error-page
  ports:
  - port: 80
    targetPort: 80
    nodePort: 31006
  type: NodePort